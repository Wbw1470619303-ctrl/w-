-- ==================== 通用功能 Tab ====================
local GeneralTab = MainWindow:Tab({ Title = "通用功能", Icon = "settings" })
GeneralTab:Section({ Title = "基础属性调整" })

-- 速度调节
GeneralTab:Slider({
    Title = "移动速度",
    Min = 16,
    Max = 200,
    Default = Global.currentWalkSpeed,
    Color = Color3.new(0, 1, 1),
    Increment = 1,
    ValueName = "Speed",
    Callback = function(value)
        Global.currentWalkSpeed = value
        local char = waitForCharacter()
        if char then
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid then humanoid.WalkSpeed = value end
        end
    end
})

-- 跳跃高度调节
GeneralTab:Slider({
    Title = "跳跃高度",
    Min = 50,
    Max = 200,
    Default = Global.currentJumpPower,
    Color = Color3.new(1, 0, 1),
    Increment = 1,
    ValueName = "Power",
    Callback = function(value)
        Global.currentJumpPower = value
        local char = waitForCharacter()
        if char then
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid then humanoid.JumpPower = value end
        end
    end
})

-- 夜视模式
GeneralTab:Toggle({
    Title = "夜视模式",
    Default = Global.nightVisionEnabled,
    Callback = function(state)
        Global.nightVisionEnabled = state
        if state then
            Lighting.Ambient = Color3.new(0.8, 0.8, 0.8)
            Lighting.OutdoorAmbient = Color3.new(0.6, 0.6, 0.6)
        else
            Lighting.Ambient = Color3.new(0.1, 0.1, 0.1)
            Lighting.OutdoorAmbient = Color3.new(0.2, 0.2, 0.2)
        end
    end
})

-- 穿墙模式（Delta 适配：避免连接泄露）
GeneralTab:Toggle({
    Title = "穿墙模式",
    Default = false,
    Callback = function(state)
        if state then
            if not Global.noclipConnection then
                Global.noclipConnection = RunService.Stepped:Connect(function()
                    local char = LocalPlayer.Character
                    if char then
                        for _, part in pairs(char:GetChildren()) do
                            if part:IsA("BasePart") then part.CanCollide = false end
                        end
                    end
                end)
            end
        else
            if Global.noclipConnection then
                Global.noclipConnection:Disconnect()
                Global.noclipConnection = nil
            end
            local char = LocalPlayer.Character
            if char then
                for _, part in pairs(char:GetChildren()) do
                    if part:IsA("BasePart") then part.CanCollide = true end
                end
            end
        end
    end
})

-- 假跳墙脚本
GeneralTab:Button({
    Title = "假跳墙",
    Callback = function()
        local success, wallhopScript = pcall(function()
            return game:HttpGet("https://raw.githubusercontent.com/ScpGuest666/Random-Roblox-script/refs/heads/main/Roblox%20WallHop%20V4%20script")
        end)
        if not success then
            WindUI:Notify({ Title = "加载失败", Content = "假跳墙脚本链接无法访问，请检查网络", Duration = 3 })
            return
        end
        
        local execSuccess = pcall(function()
            loadstring(wallhopScript)()
        end)
        
        if execSuccess then
            WindUI:Notify({ Title = "加载成功", Content = "假跳墙脚本已执行", Duration = 3 })
        else
            WindUI:Notify({ Title = "执行失败", Content = "假跳墙脚本语法错误或不兼容 Delta", Duration = 3 })
        end
    end
})

-- 无敌模式
GeneralTab:Button({
    Title = "无敌模式",
    Callback = function()
        Global.godmodeEnabled = not Global.godmodeEnabled
        local char = waitForCharacter()
        if char then
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid then
                if Global.godmodeEnabled then
                    humanoid.MaxHealth = math.huge
                    humanoid.Health = math.huge
                    humanoid:GetPropertyChangedSignal("Health"):Connect(function()
                        if humanoid.Health < math.huge then humanoid.Health = math.huge end
                    end)
                    WindUI:Notify({ Title = "成功", Content = "无敌模式已激活", Duration = 3 })
                else
                    humanoid.MaxHealth = 100
                    humanoid.Health = 100
                    WindUI:Notify({ Title = "关闭", Content = "无敌模式已关闭", Duration = 3 })
                end
            end
        else
            WindUI:Notify({ Title = "错误", Content = "角色未加载完成", Duration = 2 })
        end
    end
})

-- 点击传送
GeneralTab:Button({
    Title = "点击传送",
    Callback = function()
        local tool = Instance.new("Tool")
        tool.RequiresHandle = false
        tool.Name = "[FE] 点击传送工具"
        tool.Activated:Connect(function()
            local mouse = LocalPlayer:GetMouse()
            local char = waitForCharacter()
            if mouse.Hit and char and char:FindFirstChild("HumanoidRootPart") then
                local pos = mouse.Hit.Position + Vector3.new(0, 2.5, 0)
                char.HumanoidRootPart.CFrame = CFrame.new(pos)
            end
        end)
        tool.Parent = LocalPlayer.Backpack
        WindUI:Notify({ Title = "获取", Content = "传送工具已放入背包", Duration = 2 })
    end
})
