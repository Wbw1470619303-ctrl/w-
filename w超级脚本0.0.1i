-- Delta é€‚é…ï¼šç®€åŒ–å…¨å±€å˜é‡
local Global = {
    WindUI = nil,
    MainWindow = nil,
    noclipConnection = nil,
    nightVisionEnabled = false,
    currentWalkSpeed = 16,
    currentJumpPower = 50,
    godmodeEnabled = false,
    autoswingEnabled = false,
    wallhopConnection = nil,
    rainbowAnimationConnection = nil,
    flyConnection = nil,
    creatorTagInstances = {},
    welcomeSent = false
}

-- æ¡†æ¶åŠ è½½
local success, WindUI = pcall(function()
    local framework = game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua")
    return loadstring(framework)()
end)

if not success then
    local notification = Instance.new("ScreenGui")
    notification.Name = "LoadFailNotice"
    notification.Parent = game.Players.LocalPlayer.PlayerGui
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.fromOffset(300, 80)
    textLabel.Position = UDim2.fromScale(0.5, 0.1)
    textLabel.AnchorPoint = Vector2.new(0.5, 0.5)
    textLabel.BackgroundColor3 = Color3.new(0, 0, 0)
    textLabel.TextColor3 = Color3.new(1, 0, 0)
    textLabel.Text = "WindUI æ¡†æ¶åŠ è½½å¤±è´¥\nè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ›´æ–° Delta æ³¨å…¥å™¨"
    textLabel.TextWrapped = true
    textLabel.Parent = notification
    task.wait(5)
    notification:Destroy()
    return
end

Global.WindUI = WindUI

-- é¢„åŠ è½½æœåŠ¡
local LocalPlayer = game.Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService") -- æ–°å¢ï¼šé€‚é…æ–°æ—§èŠå¤©ç³»ç»Ÿ
local Confirmed = false

-- è§’è‰²åŠ è½½æ£€æµ‹
local function waitForCharacter()
    local timeout = 0
    while not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") do
        task.wait(0.1)
        timeout += 0.1
        if timeout >= 10 then return nil end
    end
    return LocalPlayer.Character
end

-- å½©è™¹è‰²ç”Ÿæˆ
local function getRainbowColor(hueOffset)
    local hue = (tick() * 0.2 + hueOffset) % 1
    return Color3.fromHSV(hue, 0.8, 0.9)
end

-- å°çª—å½©è™¹åŠ¨ç”»
local function startRainbowAnimation(openButton)
    if Global.rainbowAnimationConnection then
        Global.rainbowAnimationConnection:Disconnect()
    end
    Global.rainbowAnimationConnection = RunService.RenderStepped:Connect(function()
        if openButton and openButton.Parent then
            local color1 = getRainbowColor(0)
            local color2 = getRainbowColor(0.1)
            openButton.Color = ColorSequence.new(color1, color2)
        else
            Global.rainbowAnimationConnection:Disconnect()
            Global.rainbowAnimationConnection = nil
        end
    end)
end

-- æ ‡ç­¾åˆ›å»ºï¼ˆè§†è§‰ä¼˜åŒ–ï¼šèµ›åšæœ‹å…‹åƒç´ é£+Wå…ƒç´ å¼ºåŒ–ï¼Œå®Œå…¨é€‚é…Deltaï¼‰
local function createCreatorTag(player)
    if not player or player == LocalPlayer or not player.Character then return end
    local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end

    if Global.creatorTagInstances[player.UserId] then
        pcall(function() Global.creatorTagInstances[player.UserId]:Destroy() end)
        Global.creatorTagInstances[player.UserId] = nil
    end

    local success, billboardGui = pcall(function()
        local bg = Instance.new("BillboardGui")
        bg.Name = "CreatorTag"
        bg.Adornee = humanoidRootPart
        bg.Size = UDim2.fromOffset(240, 60) -- é€‚åº¦æ”¾å¤§ï¼Œæå‡è¾¨è¯†åº¦
        bg.AlwaysOnTop = true
        bg.Parent = player.Character
        bg.MaxDistance = 600 -- å»¶é•¿æ˜¾ç¤ºè·ç¦»
        bg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling -- Deltaé€‚é…ï¼šé¿å…å±‚çº§å†²çª

        -- åƒç´ é£è¾¹æ¡†ï¼ˆèµ›åšæœ‹å…‹éœ“è™¹è‰²ï¼‰
        local stroke = Instance.new("UIStroke")
        stroke.Thickness = 3 -- ç²—è¾¹æ¡†æ¨¡æ‹Ÿåƒç´ æ„Ÿ
        stroke.Color = Color3.new(0, 1, 1) -- éœ“è™¹è“
        stroke.Parent = bg

        -- æ¸å˜èƒŒæ™¯ï¼ˆæ·±é»‘+ç´«è“ï¼Œèµ›åšæœ‹å…‹ç»å…¸é…è‰²ï¼‰
        local frame = Instance.new("Frame")
        frame.Size = UDim2.fromScale(1, 1)
        frame.BackgroundTransparency = 0.2
        frame.BackgroundColor3 = Color3.new(0, 0, 0)
        -- åƒç´ é£åœ†è§’ï¼ˆé¿å…åœ†æ»‘ï¼Œè´´åˆåƒç´ æ„Ÿï¼‰
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 4)
        corner.Parent = frame
        frame.Parent = bg

        -- æ ¸å¿ƒæ–‡å­—ï¼ˆçªå‡ºWå…ƒç´ +åƒç´ å­—ä½“ï¼‰
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.fromScale(1, 1)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = "[W] è¶…çº§è„šæœ¬åˆ¶ä½œè€…" -- å¼ºåŒ–Wæ ¸å¿ƒæ ‡è¯†
        textLabel.TextColor3 = Color3.new(1, 0.8, 0) -- äº®é»„éœ“è™¹è‰²ï¼Œé«˜å¯¹æ¯”åº¦
        textLabel.TextSize = 22 -- æ”¾å¤§æ–‡å­—ï¼Œåƒç´ æ„Ÿæ›´æ˜æ˜¾
        textLabel.Font = Enum.Font.PixelSize -- åƒç´ é£æ ¼å­—ä½“ï¼ˆDeltaå…¼å®¹ï¼‰
        textLabel.TextWrapped = true
        textLabel.TextStrokeColor3 = Color3.new(0, 0, 0) -- é»‘è‰²æè¾¹ï¼Œæå‡å¯è¯»æ€§
        textLabel.TextStrokeTransparency = 0.3
        textLabel.Parent = frame

        -- åº•éƒ¨åƒç´ åŒ–è£…é¥°æ¡ï¼ˆèµ›åšæœ‹å…‹ç»†èŠ‚ï¼‰
        local bottomBar = Instance.new("Frame")
        bottomBar.Size = UDim2.fromScale(1, 0.15)
        bottomBar.Position = UDim2.fromScale(0, 0.85)
        bottomBar.BackgroundColor3 = Color3.new(1, 0, 1) -- éœ“è™¹ç²‰
        bottomBar.BackgroundTransparency = 0.4
        local barCorner = Instance.new("UICorner")
        barCorner.CornerRadius = UDim.new(0, 2)
        barCorner.Parent = bottomBar
        bottomBar.Parent = frame

        return bg
    end)

    if success and billboardGui then
        Global.creatorTagInstances[player.UserId] = billboardGui
    end
end

-- ==================== æ–°å¢ï¼šä»¿ç…§ç›®æ ‡è„šæœ¬çš„èŠå¤©å‘é€å‡½æ•°ï¼ˆDeltaå®¹é”™ï¼‰ ====================
local function SendChatMessage(message)
    pcall(function() -- Deltaé€‚é…ï¼šé¿å…èŠå¤©ç³»ç»Ÿå¼‚å¸¸å´©æºƒ
        if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
            -- é€‚é…æ–°ç‰ˆèŠå¤©ç³»ç»Ÿ
            local textChannel = TextChatService.TextChannels.RBXGeneral
            if textChannel then
                textChannel:SendAsync(message)
            end
        else
            -- é€‚é…æ—§ç‰ˆèŠå¤©ç³»ç»Ÿï¼ˆDeltaæœ€å…¼å®¹ï¼‰
            local chatEvent = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
            if chatEvent then
                local sayMsgRequest = chatEvent:FindFirstChild("SayMessageRequest")
                if sayMsgRequest then
                    sayMsgRequest:FireServer(message, "All")
                end
            end
        end
    end)
end

-- ==================== æ›¿æ¢ï¼šæ¬¢è¿ä¿¡æ¯å‘é€ï¼ˆå¤ç”¨æ–°å¢çš„SendChatMessageï¼Œä¿®æ”¹æ¶ˆæ¯å†…å®¹ï¼‰ ====================
local function sendWelcomeMessage(player)
    -- åŒé‡é˜²é‡å¤ï¼ˆé¿å…Deltaå¤šå¼€/é‡è¿å¯¼è‡´é‡å¤å‘é€ï¼‰
    if Global.welcomeSent or not player:IsDescendantOf(Players) then return end
    Global.welcomeSent = true

    -- 1. å¼ºåˆ¶æœ¬åœ°é€šçŸ¥ï¼ˆä¿ç•™åŸæœ‰é€»è¾‘ï¼‰
    pcall(function()
        local notifyGui = Instance.new("ScreenGui")
        notifyGui.Name = "WelcomeNotify"
        notifyGui.Parent = LocalPlayer.PlayerGui
        notifyGui.Archivable = false -- ç¦æ­¢Deltaå›æ”¶
        local notifyText = Instance.new("TextLabel")
        notifyText.Size = UDim2.fromOffset(400, 60)
        notifyText.Position = UDim2.fromScale(0.5, 0.05)
        notifyText.AnchorPoint = Vector2.new(0.5, 0)
        notifyText.BackgroundColor3 = Color3.new(0, 0, 0)
        notifyText.BackgroundTransparency = 0.3
        notifyText.TextColor3 = Color3.new(1, 1, 0)
        notifyText.Text = "æ£€æµ‹åˆ°wè¶…çº§è„šæœ¬åˆ¶ä½œè€… @" .. player.Name .. " æ­£åœ¨æ­¤æ¸¸æˆä¸­ æ¬¢è¿ğŸ‰ğŸ‰" -- åŒæ­¥æ¶ˆæ¯å†…å®¹
        notifyText.TextSize = 18
        notifyText.TextWrapped = true
        notifyText.Parent = notifyGui
        -- å»¶é•¿æ˜¾ç¤ºæ—¶é—´ï¼Œç¡®ä¿å¿…çœ‹
        task.wait(12)
        notifyGui:Destroy()
    end)

    -- 2. èŠå¤©å‘é€ï¼ˆä½¿ç”¨ä»¿ç…§ç›®æ ‡è„šæœ¬çš„SendChatMessageï¼Œå‘é€æŒ‡å®šå†…å®¹ï¼‰
    spawn(function()
        task.wait(1.2) -- å»¶é•¿å»¶è¿Ÿï¼Œç¡®ä¿èŠå¤©ç³»ç»Ÿå®Œå…¨åŠ è½½
        local targetMsg = "æ£€æµ‹åˆ°wè¶…çº§è„šæœ¬åˆ¶ä½œè€…wbwhnbæ­£åœ¨æ­¤æ¸¸æˆä¸­ æ¬¢è¿ğŸ‰ğŸ‰"
        SendChatMessage(targetMsg)
        WindUI:Notify({ Title = "æˆåŠŸ", Content = "æ¬¢è¿ä¿¡æ¯å·²å‘é€ï¼ˆæ‰€æœ‰äººå¯è§ï¼‰", Duration = 2 })
    end)
end

-- ==================== ä¿®å¤ï¼šæ£€æµ‹é€»è¾‘ï¼ˆä¿ç•™åŸæœ‰é€»è¾‘ï¼Œç¡®ä¿è§’è‰²åŠ è½½ï¼‰ ====================
local function detectCreator()
    local function checkAuthor()
        for _, player in ipairs(Players:GetPlayers()) do
            if player.Name == "wbwhnb" and player ~= LocalPlayer then
                -- ç¡®ä¿è§’è‰²å®Œå…¨åŠ è½½ï¼ˆå¢åŠ è§’è‰²å­˜åœ¨åˆ¤æ–­ï¼‰
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    createCreatorTag(player)
                    sendWelcomeMessage(player)
                    return true
                end
            end
        end
        return false
    end

    -- åˆå§‹æ£€æµ‹+æŒç»­æ£€æµ‹ï¼ˆé—´éš”å»¶é•¿ï¼Œå‡å°‘Deltaæ€§èƒ½å ç”¨ï¼‰
    if not checkAuthor() then
        spawn(function()
            while true do
                task.wait(3)
                if checkAuthor() then break end
            end
        end)
    end

    -- æ–°ç©å®¶åŠ å…¥ï¼šå»¶é•¿å»¶è¿Ÿåˆ°1.5ç§’ï¼Œç¡®ä¿è§’è‰²åŠ è½½å®Œæˆ
    Players.PlayerAdded:Connect(function(player)
        if player.Name == "wbwhnb" and player ~= LocalPlayer then
            task.wait(1.5)
            createCreatorTag(player)
            sendWelcomeMessage(player)
        end
    end)

    -- è§’è‰²é‡ç”Ÿï¼šå»¶è¿Ÿ1.2ç§’ï¼Œé¿å…åŠ è½½ä¸­è§¦å‘
    Players.PlayerAdded:Connect(function(player)
        if player.Name == "wbwhnb" and player ~= LocalPlayer then
            player.CharacterAdded:Connect(function()
                task.wait(1.2)
                createCreatorTag(player)
                -- é‡ç”Ÿä¸é‡å¤å‘é€æ¬¢è¿ä¿¡æ¯
            end)
        end
    end)
end

-- åˆå§‹å¼¹çª—
WindUI:Popup({
    Title = "w è¶…çº§è„šæœ¬",
    IconThemed = true,
    Content = "æ¬¢è¿ä½¿ç”¨ MR é™„å±è„šæœ¬ MR pio\nå½“å‰ç”¨æˆ·: " .. LocalPlayer.Name,
    Buttons = {
        { Title = "å–æ¶ˆ", Callback = function() end },
        { Title = "åŠ è½½è„šæœ¬", Callback = function() Confirmed = true; createMainUI() end }
    }
})

-- ä¸»UIåˆ›å»ºå‡½æ•°
function createMainUI()
    local MainWindow = WindUI:CreateWindow({
        Title = "w è¶…çº§è„šæœ¬",
        Icon = "crown",
        Author = "wbwhnb (QQ: 2318995920)",
        Folder = "wSuperScript",
        Size = UDim2.fromOffset(600, 400),
        Theme = "Dark",
        SideBarWidth = 220,
        OnClose = function() MainWindow:Hide() end,
        OnMinimize = function()
            MainWindow:Hide()
            local openButton = CoreGui:FindFirstChild("WindUI_OpenButton")
            if openButton then openButton.Visible = true end
        end,
    })
    Global.MainWindow = MainWindow

    local function createOpenButton()
        local openButton = MainWindow:EditOpenButton({
            Title = "w è¶…çº§è„šæœ¬",
            Icon = "crown",
            CornerRadius = UDim.new(0, 10),
            StrokeThickness = 2,
            Color = ColorSequence.new(getRainbowColor(0), getRainbowColor(0.1)),
            Draggable = true,
            Parent = CoreGui,
            ZIndex = 9999,
            Size = UDim2.fromOffset(120, 40),
        })
        startRainbowAnimation(openButton)
        return openButton
    end

    local openButton = createOpenButton()

    -- ä½œè€…ä¿¡æ¯Tab
    local AuthorTab = MainWindow:Tab({ Title = "ä½œè€…ä¿¡æ¯", Icon = "user" })
    AuthorTab:Section({ Title = "è„šæœ¬ä½œè€…è¯¦æƒ…" })
    AuthorTab:Paragraph({ Text = "ä½œè€…: wbwhnb" })
    AuthorTab:Paragraph({ Text = "ä½œè€… QQ: 2318995920" })
    AuthorTab:Paragraph({ Text = "è„šæœ¬æ€§è´¨: å…è´¹å¼€æº" })
    AuthorTab:Button({
        Title = "å¤åˆ¶ä½œè€… QQ",
        Callback = function()
            setclipboard("2318995920")
            WindUI:Notify({ Title = "æç¤º", Content = "QQ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", Duration = 3 })
        end
    })

    -- é€šç”¨åŠŸèƒ½Tab
    local GeneralTab = MainWindow:Tab({ Title = "é€šç”¨åŠŸèƒ½", Icon = "settings" })
    GeneralTab:Section({ Title = "åŸºç¡€å±æ€§è°ƒæ•´" })

    -- é€Ÿåº¦è°ƒèŠ‚
    GeneralTab:Slider({
        Title = "ç§»åŠ¨é€Ÿåº¦",
        Min = 16,
        Max = 200,
        Default = Global.currentWalkSpeed,
        Color = Color3.new(0, 1, 1),
        Increment = 1,
        ValueName = "Speed",
        Callback = function(value)
            Global.currentWalkSpeed = value
            local char = waitForCharacter()
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then humanoid.WalkSpeed = value end
            end
        end
    })

    -- è·³è·ƒé«˜åº¦è°ƒèŠ‚
    GeneralTab:Slider({
        Title = "è·³è·ƒé«˜åº¦",
        Min = 50,
        Max = 200,
        Default = Global.currentJumpPower,
        Color = Color3.new(1, 0, 1),
        Increment = 1,
        ValueName = "Power",
        Callback = function(value)
            Global.currentJumpPower = value
            local char = waitForCharacter()
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then humanoid.JumpPower = value end
            end
        end
    })

    -- å¤œè§†æ¨¡å¼
    GeneralTab:Toggle({
        Title = "å¤œè§†æ¨¡å¼",
        Default = Global.nightVisionEnabled,
        Callback = function(state)
            Global.nightVisionEnabled = state
            if state then
                Lighting.Ambient = Color3.new(0.8, 0.8, 0.8)
                Lighting.OutdoorAmbient = Color3.new(0.6, 0.6, 0.6)
            else
                Lighting.Ambient = Color3.new(0.1, 0.1, 0.1)
                Lighting.OutdoorAmbient = Color3.new(0.2, 0.2, 0.2)
            end
        end
    })

    -- ç©¿å¢™æ¨¡å¼
    GeneralTab:Toggle({
        Title = "ç©¿å¢™æ¨¡å¼",
        Default = false,
        Callback = function(state)
            if state then
                if not Global.noclipConnection then
                    Global.noclipConnection = RunService.Stepped:Connect(function()
                        local char = LocalPlayer.Character
                        if char then
                            for _, part in pairs(char:GetChildren()) do
                                if part:IsA("BasePart") then part.CanCollide = false end
                            end
                        end
                    end)
                end
            else
                if Global.noclipConnection then
                    Global.noclipConnection:Disconnect()
                    Global.noclipConnection = nil
                end
                local char = LocalPlayer.Character
                if char then
                    for _, part in pairs(char:GetChildren()) do
                        if part:IsA("BasePart") then part.CanCollide = true end
                    end
                end
