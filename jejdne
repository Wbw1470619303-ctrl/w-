local Global = {
    WindUI = nil,
    MainWindow = nil,
    -- ç®€åŒ–çš„å¡å¯†ç³»ç»Ÿ
    authSystem = {
        verified = false,
        licenseKey = "W_KEY_1578848467",
        groupInfo = "è·å¾—å¡å¯†åŠ qç¾¤1043674958"
    },
    -- å…¶ä»–å˜é‡...
    noclipConnection = nil,
    nightVisionEnabled = false,
    currentWalkSpeed = 16,
    currentJumpPower = 50,
    godmodeEnabled = false,
    autoswingEnabled = false,
    wallhopConnection = nil,
    rainbowAnimationConnection = nil,
    flyConnection = nil,
    creatorTagInstances = {},
    welcomeSent = false,
    ohioScript = { loaded = false },
    autoHealEnabled = false,
    autoHealConnection = nil,
    infiniteJumpEnabled = false,
    infiniteJumpConnection = nil,
    cameraLocked = false,
    originalCameraType = nil,
    currentMoveSensitivity = 1,
    forest99Night = { loaded = false }
}

-- ç®€åŒ–çš„æ¡†æ¶åŠ è½½
local success, WindUI = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
end)

if not success then
    warn("WindUI æ¡†æ¶åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")
    return
end

Global.WindUI = WindUI

-- åŸºç¡€æœåŠ¡
local LocalPlayer = game.Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")

-- ç®€åŒ–çš„å¡å¯†éªŒè¯ç³»ç»Ÿï¼ˆDeltaå…¼å®¹ï¼‰
local function checkLicense()
    -- æ–¹æ¡ˆ1: æ£€æŸ¥å…¨å±€å˜é‡
    if getgenv() and getgenv().WSuperScript_Verified == true then
        Global.authSystem.verified = true
        return true
    end
   Â 
    -- æ–¹æ¡ˆ2: æ£€æŸ¥æ–‡ä»¶
    local success, fileData = pcall(function()
        if readfile then
            return readfile("wSuperScript_auth.txt")
        end
    end)
   Â 
    if success and fileData == Global.authSystem.licenseKey then
        Global.authSystem.verified = true
        return true
    end
   Â 
    return false
end

local function saveLicense()
    pcall(function()
        -- è®¾ç½®å…¨å±€å˜é‡
        getgenv().WSuperScript_Verified = true
       Â 
        -- å†™å…¥æ–‡ä»¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        if writefile then
            writefile("wSuperScript_auth.txt", Global.authSystem.licenseKey)
        end
    end)
end

-- åˆ›å»ºç®€åŒ–çš„æˆæƒçª—å£
local function createAuthWindow()
    local AuthWindow = WindUI:CreateWindow({
        Title = "w è¶…çº§è„šæœ¬ - æˆæƒéªŒè¯",
        Icon = "shield",
        Author = "æˆæƒç³»ç»Ÿ",
        Folder = "wSuperScript_Auth",
        Size = UDim2.fromOffset(500, 350),
        Theme = "Dark",
        SideBarWidth = 0
    })

    -- ä¿¡æ¯å…¬å‘Šéƒ¨åˆ†
    local InfoTab = AuthWindow:Tab({ Title = "ä¿¡æ¯å…¬å‘Š", Icon = "info" })
    InfoTab:Section({ Title = "ğŸ“¢ é‡è¦ä¿¡æ¯" })
    InfoTab:Paragraph({ Text = Global.authSystem.groupInfo })
    InfoTab:Paragraph({ Text = "ğŸ’¡ è¯·è¾“å…¥æ­£ç¡®çš„å¡å¯†è¿›è¡ŒéªŒè¯" })
    InfoTab:Paragraph({ Text = "âš ï¸ æ¯ä¸ªå¡å¯†ä»…é™ä¸ªäººä½¿ç”¨" })

    -- æˆæƒéªŒè¯éƒ¨åˆ†
    local AuthTab = AuthWindow:Tab({ Title = "æˆæƒéªŒè¯", Icon = "key" })
    AuthTab:Section({ Title = "è¯·è¾“å…¥æˆæƒå¯†é’¥" })
   Â 
    local keyInput = AuthTab:Textbox({
        Title = "æˆæƒå¯†é’¥",
        Default = "",
        PlaceholderText = "åœ¨æ­¤è¾“å…¥å¡å¯†...",
        ClearTextOnFocus = false
    })

    AuthTab:Button({
        Title = "ç»§ç»­",
        Callback = function()
            local inputKey = keyInput:GetValue()
            if inputKey == Global.authSystem.licenseKey then
                Global.authSystem.verified = true
                saveLicense()
                AuthWindow:Destroy()
                WindUI:Notify({
                    Title = "æˆæƒæˆåŠŸ",
                    Content = "æ¬¢è¿ä½¿ç”¨ w è¶…çº§è„šæœ¬ï¼",
                    Duration = 3
                })
                task.wait(1)
                createMainUI()
            else
                WindUI:Notify({
                    Title = "æˆæƒå¤±è´¥",
                    Content = "å¯†é’¥ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•",
                    Duration = 3
                })
            end
        end
    })

    -- é»˜è®¤æ˜¾ç¤ºæˆæƒæ ‡ç­¾
    AuthWindow:SelectTab(AuthTab)
end

-- è§’è‰²åŠ è½½æ£€æµ‹
local function waitForCharacter()
    local timeout = 0
    while not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") do
        task.wait(0.1)
        timeout += 0.1
        if timeout >= 10 then return nil end
    end
    return LocalPlayer.Character
end

-- å½©è™¹è‰²ç”Ÿæˆ
local function getRainbowColor(hueOffset)
    local hue = (tick() * 0.2 + hueOffset) % 1
    return Color3.fromHSV(hue, 0.8, 0.9)
end

-- å°çª—å½©è™¹åŠ¨ç”»
local function startRainbowAnimation(openButton)
    if Global.rainbowAnimationConnection then
        Global.rainbowAnimationConnection:Disconnect()
    end
    Global.rainbowAnimationConnection = RunService.RenderStepped:Connect(function()
        if openButton and openButton.Parent then
            local color1 = getRainbowColor(0)
            local color2 = getRainbowColor(0.1)
            openButton.Color = ColorSequence.new(color1, color2)
        else
            Global.rainbowAnimationConnection:Disconnect()
            Global.rainbowAnimationConnection = nil
        end
    end)
end

-- ä¸»UIåˆ›å»º
function createMainUI()
    local MainWindow = WindUI:CreateWindow({
        Title = "w è¶…çº§è„šæœ¬ - å·²æˆæƒ",
        Icon = "crown",
        Author = "wbwhnb (QQ: 2318995920)",
        Folder = "wSuperScript",
        Size = UDim2.fromOffset(600, 400),
        Theme = "Dark",
        SideBarWidth = 220
    })
    Global.MainWindow = MainWindow

    local function createOpenButton()
        local openButton = MainWindow:EditOpenButton({
            Title = "w è¶…çº§è„šæœ¬",
            Icon = "crown",
            CornerRadius = UDim.new(0, 10),
            StrokeThickness = 2,
            Color = ColorSequence.new(getRainbowColor(0), getRainbowColor(0.1)),
            Draggable = true,
            Parent = CoreGui,
            ZIndex = 9999,
            Size = UDim2.fromOffset(120, 40),
        })
        startRainbowAnimation(openButton)
        return openButton
    end

    local openButton = createOpenButton()

    -- ä¿¡æ¯å…¬å‘ŠTab
    local AnnouncementTab = MainWindow:Tab({ Title = "ä¿¡æ¯å…¬å‘Š", Icon = "info" })
    AnnouncementTab:Section({ Title = "ğŸ“¢ é‡è¦å…¬å‘Š" })
    AnnouncementTab:Paragraph({ Text = "æ¬¢è¿ä½¿ç”¨ w è¶…çº§è„šæœ¬ï¼" })
    AnnouncementTab:Paragraph({ Text = "ğŸ‘¥ äº¤æµç¾¤ç»„ï¼š" .. Global.authSystem.groupInfo })

    -- ä½œè€…ä¿¡æ¯Tab
    local AuthorTab = MainWindow:Tab({ Title = "ä½œè€…ä¿¡æ¯", Icon = "user" })
    AuthorTab:Section({ Title = "è„šæœ¬ä½œè€…è¯¦æƒ…" })
    AuthorTab:Paragraph({ Text = "ä½œè€…: wbwhnb" })
    AuthorTab:Paragraph({ Text = "ä½œè€… QQ: 2318995920" })
    AuthorTab:Button({
        Title = "å¤åˆ¶ä½œè€… QQ",
        Callback = function()
            setclipboard("2318995920")
            WindUI:Notify({ Title = "æç¤º", Content = "QQ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", Duration = 3 })
        end
    })

    -- é€šç”¨åŠŸèƒ½Tab
    local GeneralTab = MainWindow:Tab({ Title = "é€šç”¨åŠŸèƒ½", Icon = "settings" })
    GeneralTab:Section({ Title = "åŸºç¡€å±æ€§è°ƒæ•´" })

    -- é€Ÿåº¦è°ƒèŠ‚
    GeneralTab:Button({
        Title = "é€Ÿåº¦: æ­£å¸¸(16)",
        Callback = function()
            if Global.currentWalkSpeed == 16 then
                Global.currentWalkSpeed = 50
                local char = waitForCharacter()
                if char then
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    if humanoid then humanoid.WalkSpeed = 50 end
                end
            elseif Global.currentWalkSpeed == 50 then
                Global.currentWalkSpeed = 100
                local char = waitForCharacter()
                if char then
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    if humanoid then humanoid.WalkSpeed = 100 end
                end
            elseif Global.currentWalkSpeed == 100 then
                Global.currentWalkSpeed = 200
                local char = waitForCharacter()
                if char then
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    if humanoid then humanoid.WalkSpeed = 200 end
                end
            else
                Global.currentWalkSpeed = 16
                local char = waitForCharacter()
                if char then
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    if humanoid then humanoid.WalkSpeed = 16 end
                end
            end
            WindUI:Notify({ Title = "é€Ÿåº¦è®¾ç½®", Content = "ç§»åŠ¨é€Ÿåº¦å·²è®¾ç½®ä¸º: " .. Global.currentWalkSpeed, Duration = 2 })
        end
    })

    -- è·³è·ƒé«˜åº¦è°ƒèŠ‚
    GeneralTab:Button({
        Title = "è·³è·ƒ: æ­£å¸¸(50)",
        Callback = function()
            if Global.currentJumpPower == 50 then
                Global.currentJumpPower = 100
            elseif Global.currentJumpPower == 100 then
                Global.currentJumpPower = 150
            elseif Global.currentJumpPower == 150 then
                Global.currentJumpPower = 200
            else
                Global.currentJumpPower = 50
            end
           Â 
            local char = waitForCharacter()
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then humanoid.JumpPower = Global.currentJumpPower end
            end
            WindUI:Notify({ Title = "è·³è·ƒè®¾ç½®", Content = "è·³è·ƒé«˜åº¦å·²è®¾ç½®ä¸º: " .. Global.currentJumpPower, Duration = 2 })
        end
    })

    -- å¤œè§†æ¨¡å¼
    GeneralTab:Toggle({
        Title = "å¤œè§†æ¨¡å¼",
        Default = Global.nightVisionEnabled,
        Callback = function(state)
            Global.nightVisionEnabled = state
            if state then
                Lighting.Ambient = Color3.new(0.8, 0.8, 0.8)
            else
                Lighting.Ambient = Color3.new(0.1, 0.1, 0.1)
            end
        end
    })

    -- ç©¿å¢™æ¨¡å¼
    GeneralTab:Toggle({
        Title = "ç©¿å¢™æ¨¡å¼",
        Default = false,
        Callback = function(state)
            if state then
                if not Global.noclipConnection then
                    Global.noclipConnection = RunService.Stepped:Connect(function()
                        local char = LocalPlayer.Character
                        if char then
                            for _, part in pairs(char:GetChildren()) do
                                if part:IsA("BasePart") then part.CanCollide = false end
                            end
                        end
                    end)
                end
            else
                if Global.noclipConnection then
                    Global.noclipConnection:Disconnect()
                    Global.noclipConnection = nil
                end
            end
        end
    })

    -- æ— æ•Œæ¨¡å¼
    GeneralTab:Button({
        Title = "æ— æ•Œæ¨¡å¼",
        Callback = function()
            Global.godmodeEnabled = not Global.godmodeEnabled
            local char = waitForCharacter()
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    if Global.godmodeEnabled then
                        humanoid.MaxHealth = math.huge
                        humanoid.Health = math.huge
                        WindUI:Notify({ Title = "æˆåŠŸ", Content = "æ— æ•Œæ¨¡å¼å·²æ¿€æ´»", Duration = 3 })
                    else
                        humanoid.MaxHealth = 100
                        humanoid.Health = 100
                        WindUI:Notify({ Title = "å…³é—­", Content = "æ— æ•Œæ¨¡å¼å·²å…³é—­", Duration = 3 })
                    end
                end
            end
        end
    })

    -- ç‚¹å‡»ä¼ é€
    GeneralTab:Button({
        Title = "ç‚¹å‡»ä¼ é€",
        Callback = function()
            local tool = Instance.new("Tool")
            tool.RequiresHandle = false
            tool.Name = "[FE] ç‚¹å‡»ä¼ é€å·¥å…·"
            tool.Activated:Connect(function()
                local mouse = LocalPlayer:GetMouse()
                local char = waitForCharacter()
                if mouse.Hit and char and char:FindFirstChild("HumanoidRootPart") then
                    char.HumanoidRootPart.CFrame = CFrame.new(mouse.Hit.Position + Vector3.new(0, 3, 0))
                end
            end)
            tool.Parent = LocalPlayer.Backpack
            WindUI:Notify({ Title = "è·å–", Content = "ä¼ é€å·¥å…·å·²æ”¾å…¥èƒŒåŒ…", Duration = 2 })
        end
    })

    -- åŠ è½½ xahub
    GeneralTab:Section({ Title = "ç¬¬ä¸‰æ–¹è„šæœ¬" })
    GeneralTab:Button({
        Title = "åŠ è½½ xahub",
        Callback = function()
            local success = pcall(function()Â 
                loadstring(game:HttpGet("https://pastebin.com/raw/h8nC0fLb"))()
            end)
            if success then
                WindUI:Notify({ Title = "åŠ è½½æˆåŠŸ", Content = "xahub è„šæœ¬å·²æ‰§è¡Œ", Duration = 3 })
            else
                WindUI:Notify({ Title = "åŠ è½½å¤±è´¥", Content = "xahub é“¾æ¥æ— æ³•è®¿é—®", Duration = 3 })
            end
        end
    })

    -- å¨±ä¹åŠŸèƒ½Tab
    local FunTab = MainWindow:Tab({ Title = "å¨±ä¹åŠŸèƒ½", Icon = "emoji" })
    FunTab:Button({
        Title = "è‡ªæ€",
        Callback = function()
            local char = waitForCharacter()
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then humanoid.Health = 0 end
            end
        end
    })

    -- DOORS Tab
    local DoorsTab = MainWindow:Tab({ Title = "DOORS", Icon = "door-open" })
    DoorsTab:Button({
        Title = "æœ€å¼ºæ±‰åŒ–è„šæœ¬",
        Callback = function()
            local success = pcall(function()Â 
                loadstring(game:HttpGet("https://pastebin.com/raw/65TwT8ja"))()
            end)
            WindUI:Notify({
                Title = success and "åŠ è½½æˆåŠŸ" or "åŠ è½½å¤±è´¥",
                Content = success and "DOORS æ±‰åŒ–è„šæœ¬å·²æ‰§è¡Œ" or "è„šæœ¬é“¾æ¥å¤±æ•ˆ",
                Duration = 3
            })
        end
    })

    -- åŠ›é‡ä¼ å¥‡Tab
    local MuscleLegendsTab = MainWindow:Tab({ Title = "åŠ›é‡ä¼ å¥‡", Icon = "dumbbell" })
    MuscleLegendsTab:Button({
        Title = "æ¯è„šæœ¬",
        Callback = function()
            local success = pcall(function()Â 
                loadstring(game:HttpGet("https://raw.githubusercontent.com/zuohongjian/bjb/main/llcq"))()
            end)
            WindUI:Notify({
                Title = success and "åŠ è½½æˆåŠŸ" or "åŠ è½½å¤±è´¥",
                Content = success and "æ¯è„šæœ¬å·²æ‰§è¡Œ" or "è„šæœ¬é“¾æ¥å¤±æ•ˆ",
                Duration = 3
            })
        end
    })

    -- æˆæƒç®¡ç†Tab
    local AuthManagementTab = MainWindow:Tab({ Title = "æˆæƒç®¡ç†", Icon = "shield" })
    AuthManagementTab:Section({ Title = "æˆæƒçŠ¶æ€" })
    AuthManagementTab:Paragraph({ Text = "å½“å‰æˆæƒçŠ¶æ€: âœ… å·²éªŒè¯" })
    AuthManagementTab:Paragraph({ Text = "æ”¯æŒç¾¤ç»„: " .. Global.authSystem.groupInfo })
    AuthManagementTab:Button({
        Title = "é‡æ–°éªŒè¯æˆæƒ",
        Callback = function()
            Global.authSystem.verified = false
            pcall(function()
                getgenv().WSuperScript_Verified = false
                if writefile and delfile then
                    delfile("wSuperScript_auth.txt")
                end
            end)
            MainWindow:Destroy()
            createAuthWindow()
        end
    })

    -- ä¿æ´»é€»è¾‘
    spawn(function()
        while true do
            task.wait(3)
            if Global.MainWindow then
                local openButton = CoreGui:FindFirstChild("WindUI_OpenButton")
                if not openButton then
                    openButton = createOpenButton()
                else
                    openButton.Visible = true
                    if not Global.rainbowAnimationConnection or not Global.rainbowAnimationConnection.Connected then
                        startRainbowAnimation(openButton)
                    end
                end
            end
        end
    end)

    WindUI:Notify({
        Title = "åŠ è½½æˆåŠŸ",
        Content = "è„šæœ¬åŠŸèƒ½å·²å®Œå…¨è§£é”ï¼",
        Duration = 3
    })
end

-- åˆå§‹å¯åŠ¨é€»è¾‘
if checkLicense() then
    createMainUI()
else
    createAuthWindow()
end
