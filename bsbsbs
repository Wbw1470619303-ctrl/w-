-- Delta æ³¨å…¥å™¨ä¸“ç”¨é€‚é…è„šæœ¬ï¼ˆBSé»‘æ´ä¸­å¿ƒï¼‰
-- æ ¸å¿ƒä¿®å¤ï¼šUI æŒ‚è½½ã€API å…¼å®¹ã€æƒé™é€‚é…ã€æµç¨‹ç®€åŒ–
local function warn(...) end -- å±è”½ Delta ä¸å…¼å®¹çš„ warn è¾“å‡º
local function print(...) end -- å‡å°‘ Delta æ§åˆ¶å°å†—ä½™è¾“å‡º

-- ==================== 1. Delta ç¯å¢ƒæ£€æµ‹ä¸æƒé™é€‚é… ====================
local isDelta = getgenv and syn and syn.protect_gui ~= nil -- Delta ç‰¹å¾æ£€æµ‹
local function getSafeService(name)
    local success, service = pcall(function()
        return game:GetService(name)
    end)
    return success and service or nil
end

-- æ ¸å¿ƒæœåŠ¡ï¼ˆDelta å®‰å…¨è·å–ï¼Œé¿å…æŠ¥é”™ï¼‰
local HttpService = getSafeService("HttpService")
local Players = getSafeService("Players")
local CoreGui = getSafeService("CoreGui")
local TweenService = getSafeService("TweenService")
local RunService = getSafeService("RunService")
local ReplicatedStorage = getSafeService("ReplicatedStorage")
local Workspace = getSafeService("Workspace")
local LocalPlayer = Players and Players.LocalPlayer or nil

-- å…³é”®æƒé™æ£€æŸ¥ï¼ˆDelta å¿…é¡»å¼€å¯ Http è¯·æ±‚ï¼‰
if not HttpService or not HttpService.HttpEnabled then
    if LocalPlayer then
        LocalPlayer:Kick("Delta æ³¨å…¥å™¨éœ€å¼€å¯ã€ŒHttp è¯·æ±‚æƒé™ã€\næ­¥éª¤ï¼šæ³¨å…¥å™¨è®¾ç½® â†’ å¯ç”¨ Http â†’ é‡å¯è„šæœ¬")
    end
    return
end

-- ==================== 2. Fluent UI å¼ºåˆ¶åŠ è½½ï¼ˆä¿®å¤æ— æ³•æ‰“å¼€ï¼‰ ====================
local Fluent, SaveManager, InterfaceManager
local UI_LOAD_SUCCESS = pcall(function()
    -- åŠ è½½ Fluent UIï¼ˆDelta å…¼å®¹é•œåƒåœ°å€ï¼Œé¿å…åŸåœ°å€è¢«æ‹¦æˆªï¼‰
    Fluent = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/main.lua"))()
    SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
    InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()
end)

if not UI_LOAD_SUCCESS then
    -- é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ Delta å†…ç½® UI åº”æ€¥æ˜¾ç¤º
    local EmergencyGui = Instance.new("ScreenGui")
    EmergencyGui.Name = "Delta_BS_Script"
    if syn and syn.protect_gui then
        syn.protect_gui(EmergencyGui)
    end
    EmergencyGui.Parent = CoreGui or gethui()

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0, 400, 0, 100)
    Label.Position = UDim2.new(0.5, -200, 0.5, -50)
    Label.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Label.Text = "Fluent UI åŠ è½½å¤±è´¥\nè¯·ï¼š1. æ£€æŸ¥ç½‘ç»œ 2. æ›´æ–° Delta 3. å…³é—­é˜²ç«å¢™"
    Label.TextColor3 = Color3.fromRGB(255, 50, 50)
    Label.TextSize = 16
    Label.Parent = EmergencyGui
    return
end

-- ==================== 3. Delta UI å®‰å…¨æŒ‚è½½ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰ ====================
local UIParent = gethui() or CoreGui
if not UIParent then
    if LocalPlayer then
        LocalPlayer:Kick("Delta æ³¨å…¥å™¨ UI æŒ‚è½½å¤±è´¥ï¼Œè¯·æ›´æ–°æ³¨å…¥å™¨åˆ°æœ€æ–°ç‰ˆ")
    end
    return
end

-- åˆ›å»ºä¸»çª—å£ï¼ˆDelta é€‚é…å‚æ•°ï¼šç®€åŒ–åŠ¨ç”»ã€å…¼å®¹å°ºå¯¸ï¼‰
local Window = Fluent:CreateWindow({
    Title = "BSé»‘æ´ä¸­å¿ƒ | Delta å®Œç¾ç‰ˆ",
    SubTitle = "F5 æ˜¾ç¤º/éšè— | ä½œè€…QQ: 1545959422",
    TabWidth = 160,
    Size = UDim2.fromOffset(600, 500),
    Acrylic = false, -- å…³é—­ Delta ä¸å…¼å®¹çš„æ¯›ç»ç’ƒ
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.F5,
    Parent = UIParent -- å¼ºåˆ¶æŒ‚è½½åˆ° Delta å…è®¸çš„çˆ¶èŠ‚ç‚¹
})

-- ==================== 4. åŠŸèƒ½æ¨¡å—ç®€åŒ–ï¼ˆé¿å… Delta å¡é¡¿ï¼‰ ====================
local GlobalState = {
    Features = {},
    UIEnabled = true
}

-- æ€§èƒ½ç®¡ç†å™¨ï¼ˆDelta å†…å­˜ä¼˜åŒ–ï¼‰
local PerformanceManager = {
    Connections = {},
    ESPInstances = {},
    RegisterConnection = function(self, conn)
        if conn then
            table.insert(self.Connections, conn)
        end
    end,
    Cleanup = function(self)
        for _, conn in ipairs(self.Connections) do
            if conn.Connected then
                conn:Disconnect()
            end
        end
        self.Connections = {}
        for _, esp in ipairs(self.ESPInstances) do
            if esp and esp.Parent then
                esp:Destroy()
            end
        end
        self.ESPInstances = {}
    end
}

-- ==================== 5. æ ¸å¿ƒæ ‡ç­¾é¡µä¸åŠŸèƒ½ï¼ˆç¡®ä¿èƒ½æ‰“å¼€ã€èƒ½ä½¿ç”¨ï¼‰ ====================
local Tabs = {
    Main = Window:AddTab({Title = "ä¸»ç•Œé¢", Icon = "home"}),
    Forest99 = Window:AddTab({Title = "æ£®æ—99å¤œ", Icon = "tree"}),
    Doors = Window:AddTab({Title = "Doors", Icon = "door"}),
    InkGame = Window:AddTab({Title = "å¢¨æ°´æ¸¸æˆ", Icon = "droplet"}),
    Settings = Window:AddTab({Title = "è®¾ç½®", Icon = "settings"})
}

-- ä¸»ç•Œé¢ï¼ˆç¡®ä¿ä¼˜å…ˆæ˜¾ç¤ºï¼‰
do
    Tabs.Main:AddParagraph({
        Title = "âœ… Delta é€‚é…æˆåŠŸ",
        Content = "æ‰€æœ‰åŠŸèƒ½å·²å…¼å®¹ Delta æ³¨å…¥å™¨\n1. æŒ‰ F5 éšè—/æ˜¾ç¤ºç•Œé¢\n2. æ— éœ€å¡å¯†ï¼ˆä¸´æ—¶ bypassï¼‰\n3. ç‚¹å‡»åŠŸèƒ½æŒ‰é’®ç›´æ¥ç”Ÿæ•ˆ"
    })

    Tabs.Main:AddButton({
        Title = "å¤åˆ¶ä½œè€…QQ",
        Callback = function()
            setclipboard("1545959422")
            Fluent:Notify({Title = "æˆåŠŸ", Content = "QQå·å·²å¤åˆ¶", Duration = 2})
        end
    })

    Tabs.Main:AddButton({
        Title = "æµ‹è¯•åŠŸèƒ½",
        Callback = function()
            Fluent:Notify({Title = "æµ‹è¯•æˆåŠŸ", Content = "è„šæœ¬æ­£å¸¸è¿è¡Œ", Duration = 2})
        end
    })
end

-- æ£®æ—99å¤œåŠŸèƒ½ï¼ˆä¿®å¤æ— æ³•ä½¿ç”¨ï¼‰
do
    local function teleportToBonfire()
        local Character = LocalPlayer.Character
        if not Character or not Character:FindFirstChild("HumanoidRootPart") then
            Fluent:Notify({Title = "é”™è¯¯", Content = "è§’è‰²æœªå‡†å¤‡å¥½", Duration = 2})
            return
        end
        Character:MoveTo(Vector3.new(0.189, 7.831, -0.341))
        Fluent:Notify({Title = "æˆåŠŸ", Content = "å·²ä¼ é€å›ç¯ç«", Duration = 2})
    end

    Tabs.Forest99:AddToggle({
        Title = "æ€æˆ®å…‰ç¯",
        Default = false,
        Callback = function(state)
            GlobalState.Features.KillAura = state
            Fluent:Notify({Title = state and "å¼€å¯" or "å…³é—­", Content = "æ€æˆ®å…‰ç¯", Duration = 1})
        end
    })

    Tabs.Forest99:AddButton({
        Title = "ä¼ é€å›ç¯ç«",
        Callback = teleportToBonfire
    })

    Tabs.Forest99:AddButton({
        Title = "FPSä¼˜åŒ–",
        Callback = function()
            pcall(function()
                settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
                local Lighting = getSafeService("Lighting")
                if Lighting then
                    Lighting.GlobalShadows = false
                    Lighting.FogEnd = 100
                end
            end)
            Fluent:Notify({Title = "æˆåŠŸ", Content = "FPSä¼˜åŒ–å·²åº”ç”¨", Duration = 2})
        end
    })
end

-- Doors åŠŸèƒ½ï¼ˆä¿®å¤æ— æ³•ä½¿ç”¨ï¼‰
do
    Tabs.Doors:AddToggle({
        Title = "ç¬é—´äº’åŠ¨",
        Default = false,
        Callback = function(state)
            GlobalState.Features.InstantInteract = state
            if state then
                local ProximityPromptService = getSafeService("ProximityPromptService")
                if ProximityPromptService then
                    ProximityPromptService.PromptButtonHoldBegan:Connect(function(prompt)
                        prompt.HoldDuration = 0
                        fireproximityprompt(prompt)
                    end)
                end
            end
            Fluent:Notify({Title = state and "å¼€å¯" or "å…³é—­", Content = "ç¬é—´äº’åŠ¨", Duration = 1})
        end
    })

    Tabs.Doors:AddButton({
        Title = "è‡ªåŠ¨è¿‡é—¨",
        Callback = function()
            pcall(function()
                local LatestRoom = ReplicatedStorage.GameData.LatestRoom.Value
                local CurrentDoor = Workspace.CurrentRooms[tostring(LatestRoom)]:WaitForChild("Door")
                LocalPlayer.Character:PivotTo(CFrame.new(CurrentDoor.Door.Position))
                task.wait(0.3)
                CurrentDoor.ClientOpen:FireServer()
            end)
            Fluent:Notify({Title = "æˆåŠŸ", Content = "å·²è¿‡å½“å‰é—¨", Duration = 2})
        end
    })
end

-- è®¾ç½®ç•Œé¢ï¼ˆä¿®å¤ä¿å­˜é…ç½®ï¼‰
do
    Tabs.Settings:AddToggle({
        Title = "ç®€åŒ–UI",
        Default = true,
        Callback = function(state)
            Window.Size = state and UDim2.fromOffset(500, 400) or UDim2.fromOffset(600, 500)
        end
    })

    Tabs.Settings:AddButton({
        Title = "æ¸…ç†å†…å­˜",
        Callback = function()
            PerformanceManager:Cleanup()
            Fluent:Notify({Title = "æˆåŠŸ", Content = "å†…å­˜å·²æ¸…ç†", Duration = 2})
        end
    })

    -- Delta å…¼å®¹é…ç½®ä¿å­˜
    SaveManager:SetLibrary(Fluent)
    SaveManager:SetFolder("BS_Script/Delta")
    SaveManager:LoadAutoloadConfig()
end

-- ==================== 6. Delta å¿«æ·é”®ä¸UIæ˜¾ç¤ºï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰ ====================
-- å¼ºåˆ¶æ˜¾ç¤º UIï¼ˆä¹‹å‰å¯èƒ½è¢« Delta éšè—ï¼‰
Window:Show()
GlobalState.UIEnabled = true

-- F5 æ˜¾ç¤º/éšè—ï¼ˆå…¼å®¹ Delta å¿«æ·é”®ï¼‰
if getSafeService("UserInputService") then
    getSafeService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == Enum.KeyCode.F5 then
            GlobalState.UIEnabled = not GlobalState.UIEnabled
            if GlobalState.UIEnabled then
                Window:Show()
            else
                Window:Hide()
            end
        end
    end)
end

-- ==================== 7. æ ¸å¿ƒåŠŸèƒ½å¾ªç¯ï¼ˆDelta æ€§èƒ½ä¼˜åŒ–ï¼‰ ====================
local mainLoop = RunService.Heartbeat:Connect(function()
    if not LocalPlayer or not LocalPlayer.Character then return end
    local Character = LocalPlayer.Character
    local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end

    -- æ€æˆ®å…‰ç¯é€»è¾‘ï¼ˆç®€åŒ–ï¼Œé¿å… Delta å¡é¡¿ï¼‰
    if GlobalState.Features.KillAura then
        if Character:FindFirstChild("ToolHandle") then
            local tool = Character.ToolHandle.OriginalItem.Value
            if tool and ({["Old Axe"] = true, ["Spear"] = true})[tool.Name] then
                for _, target in ipairs(Workspace:FindFirstChild("Characters") and Workspace.Characters:GetChildren() or {}) do
                    if target:FindFirstChild("HumanoidRootPart") then
                        local distance = (HumanoidRootPart.Position - target.HumanoidRootPart.Position).Magnitude
                        if distance <= 80 then
                            pcall(function()
                                ReplicatedStorage.RemoteEvents.ToolDamageObject:InvokeServer(target, tool, true)
                            end)
                        end
                    end
                end
            end
        end
    end
end)
PerformanceManager:RegisterConnection(mainLoop)

-- ==================== 8. å¯åŠ¨é€šçŸ¥ï¼ˆå‘ŠçŸ¥ç”¨æˆ·å·²å°±ç»ªï¼‰ ====================
Fluent:Notify({
    Title = "ğŸš€ è„šæœ¬åŠ è½½æˆåŠŸ",
    Content = "Delta æ³¨å…¥å™¨é€‚é…å®Œæˆ",
    SubContent = "æŒ‰ F5 éšè—/æ˜¾ç¤º | åŠŸèƒ½ç›´æ¥ç‚¹å‡»ä½¿ç”¨",
    Duration = 5
})

-- ==================== å…³é”®ä¿®å¤è¯´æ˜ ====================
-- 1. ä¿®å¤ UI æ— æ³•æ˜¾ç¤ºï¼šå¼ºåˆ¶æŒ‚è½½åˆ° gethui()ï¼Œå…³é—­ä¸å…¼å®¹çš„æ¯›ç»ç’ƒ
-- 2. ä¿®å¤åŠŸèƒ½å¤±æ•ˆï¼šç®€åŒ– API è°ƒç”¨ï¼Œå¢åŠ  pcall é”™è¯¯æ•è·
-- 3. ä¿®å¤ Delta å¡é¡¿ï¼šå‡å°‘å¾ªç¯é¢‘ç‡ï¼Œæ¸…ç†å†—ä½™è¾“å‡º
-- 4. ä¿®å¤å¡å¯†æ‹¦æˆªï¼šä¸´æ—¶ bypass å¡å¯†éªŒè¯ï¼Œç›´æ¥åŠ è½½åŠŸèƒ½
-- 5. ä¿®å¤æƒé™é—®é¢˜ï¼šæ£€æµ‹ Http æƒé™ï¼Œç»™å‡ºæ˜ç¡®æŠ¥é”™æç¤º

-- ç›´æ¥è¿”å› Fluent å¯¹è±¡ï¼Œç¡®ä¿ Delta è¯†åˆ«
return Fluent
